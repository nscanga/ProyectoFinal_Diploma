<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurar Backup - Distribuidora Los Amigos</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>

    <div class="breadcrumb">
        <a href="../general/topic_20_main.html">Inicio</a>
        <span>‚Ä∫</span>
        <a href="#">Backup y Restore</a>
        <span>‚Ä∫</span>
        <span>Restaurar Base de Datos</span>
    </div>

    <h1>Restaurar bases de datos desde backup</h1>

    <section id="introduccion">
        <h2>¬øQu√© hace esta pantalla?</h2>
        <p>
            Permite reemplazar por completo las bases de datos del sistema utilizando archivos de respaldo previamente generados.
            El formulario ejecuta <code>BackupService.ExecuteRestore</code>, que a su vez invoca
            <code>BackUpLogic.PerformRestore</code> y aplica la restauraci√≥n sobre las bases <strong>DistribuidoraLosAmigos</strong>,
            <strong>Login</strong> y <strong>Bitacora</strong>.
        </p>
        <div class="warning">
            <strong>‚ö†Ô∏è Advertencia:</strong> la restauraci√≥n elimina toda la informaci√≥n existente y la reemplaza por la contenida
            en los archivos <code>.bak</code>. No es posible deshacer la operaci√≥n.
        </div>
    </section>

    <section id="requisitos">
        <h2>Antes de comenzar</h2>
        <ul>
            <li>Gener√° un backup reciente del entorno actual por si necesit√°s volver atr√°s.</li>
            <li>Cerr√° todas las sesiones que est√©n usando la base de datos (aplicaciones, reportes, etc.).</li>
            <li>Verific√° que cont√°s con los tres archivos <code>.bak</code> correspondientes y que son compatibles con la versi√≥n de SQL Server.</li>
            <li>Ejecut√° la aplicaci√≥n con permisos suficientes para leer la carpeta de origen.</li>
        </ul>
    </section>

    <section id="acceso">
        <h2>C√≥mo acceder</h2>
        <ol>
            <li>Desde la pantalla principal abr√≠ el men√∫ <strong>Backup y Restore</strong>.</li>
            <li>Seleccion√° <strong>Restaurar Backup</strong>.</li>
            <li>El sistema mostrar√° el formulario <strong>RestoreForm</strong>.</li>
        </ol>
    </section>

    <section id="flujo">
        <h2>Procedimiento paso a paso</h2>
        <ol>
            <li>Presion√° el bot√≥n <strong>Restaurar Base de Datos</strong>.</li>
            <li>Le√© las advertencias y confirm√° que comprend√©s el alcance de la operaci√≥n.</li>
            <li>Eleg√≠ la carpeta que contiene los archivos <code>.bak</code>. El di√°logo sugerir√° las rutas configuradas
                en <code>App.config</code> (<strong>BackupPath1</strong>, <strong>BackupPath2</strong>, <strong>BackupPath3</strong>).</li>
            <li>El sistema listar√° los archivos encontrados. Revis√° que se muestren los tres respaldos esperados.</li>
            <li>Confirm√° la restauraci√≥n cuando se solicite (se piden varias confirmaciones consecutivas).</li>
            <li>Esper√° a que termine el proceso; el bot√≥n queda deshabilitado y se muestra <em>‚ÄúRestaurando...‚Äù</em>.</li>
            <li>Al finalizar se informar√° el √©xito de la operaci√≥n y se registrar√° en la bit√°cora.</li>
            <li>Reinici√° la aplicaci√≥n para garantizar que todas las conexiones se restablezcan correctamente.</li>
        </ol>
    </section>

    <section id="validaciones">
        <h2>Validaciones autom√°ticas</h2>
        <ul>
            <li>Verificaci√≥n de ruta: si la carpeta no existe, se aborta la operaci√≥n con un mensaje descriptivo.</li>
            <li>Existencia de archivos: se buscan coincidencias exactas (<code>NombreBD.bak</code>) y variantes con timestamp.</li>
            <li>Permisos de lectura: ante excepciones <code>UnauthorizedAccessException</code> se informa al usuario.</li>
            <li>Registro en logs: todos los errores se guardan mediante <code>LoggerService.WriteException</code>.</li>
        </ul>
    </section>

    <section id="archivos">
        <h2>Archivos requeridos</h2>
        <pre><code>[Carpeta de backup]/
‚îú‚îÄ DistribuidoraLosAmigos*.bak
‚îú‚îÄ Login*.bak
‚îî‚îÄ Bitacora*.bak</code></pre>
        <p>
            El proceso utiliza las claves <code>Database1Name</code>, <code>Database2Name</code> y <code>Database3Name</code>
            para validar cada archivo. Si alguno falta se cancela la restauraci√≥n con un mensaje espec√≠fico.
        </p>
    </section>

    <section id="problemas">
        <h2>Errores frecuentes y soluciones</h2>
        <table>
            <thead>
                <tr>
                    <th>Mensaje</th>
                    <th>Motivo</th>
                    <th>Acci√≥n sugerida</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>‚ÄúLa carpeta seleccionada no contiene archivos de backup (.bak).‚Äù</td>
                    <td>No se encontraron archivos con la extensi√≥n indicada.</td>
                    <td>Verific√° la ruta o copi√° los archivos correctos antes de continuar.</td>
                </tr>
                <tr>
                    <td>‚ÄúNo se encontr√≥ el archivo de backup para la base de datos ‚Ä¶‚Äù</td>
                    <td>Falta alguno de los archivos necesarios o el nombre no coincide.</td>
                    <td>Asegurate de incluir los tres respaldos y que conserven el prefijo de la base.</td>
                </tr>
                <tr>
                    <td>‚ÄúNo tiene permisos para acceder a la carpeta seleccionada.‚Äù</td>
                    <td>El usuario actual no puede leer los archivos.</td>
                    <td>Ejecut√° la aplicaci√≥n como administrador o mov√© los archivos a una carpeta accesible.</td>
                </tr>
                <tr>
                    <td>Errores SQL relacionados con <code>RESTORE DATABASE</code>.</td>
                    <td>La instancia de SQL Server deneg√≥ la restauraci√≥n.</td>
                    <td>Verific√° que no existan conexiones abiertas y que el usuario tenga permisos de <code>RESTORE</code> y <code>ALTER</code>.</td>
                </tr>
            </tbody>
        </table>
    </section>

    <section id="recomendaciones">
        <h2>Buenas pr√°cticas despu√©s de restaurar</h2>
        <ul>
            <li>Valid√° que los datos se hayan actualizado correctamente (usuarios, pedidos, inventario).</li>
            <li>Revis√° la bit√°cora para confirmar que no quedaron errores pendientes.</li>
            <li>Gener√° un nuevo backup apenas termines la restauraci√≥n para contar con un punto de recuperaci√≥n limpio.</li>
            <li>Document√° qui√©n realiz√≥ el proceso y desde qu√© archivos para futuras auditor√≠as.</li>
        </ul>
    </section>

    <section id="relacionados">
        <h2>Ver tambi√©n</h2>
        <ul class="no-bullets">
            <li>üìÑ <a href="topic_22_backup.html">Crear backup de las bases de datos</a></li>
            <li>üìÑ <a href="topic_25_bitacora.html">Bit√°cora del sistema</a></li>
        </ul>
    </section>

    <footer>
        <p>¬© 2024 Distribuidora Los Amigos - Sistema de Gesti√≥n</p>
        <p>Documentaci√≥n de ayuda contextual (F1)</p>
    </footer>

</body>
</html>
